---
title: "NPSS"
author: "Ross Kelly"
date: "30/03/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Net Promoter Score and Confidence Intervals: A cautionary tale

Those who have undertaken quantitative consumer research to understand competitive positioning are likely to have come across this scenario. Your team has run a (relatively) large consumer survey to show that your brand is more popular than the competition. The CEO wants to proclaim that our brand is better than our major competitor, since our NPS (Net Promoter Score) is higher! There's just one problem - it's for a serious fundraising round, and the legal team are concerned that we could be overstating our advantage. 

_"Is there a way we can say that the difference in Net Promoter Score is_ __statistically significant?"__

The answer to this question, as always, is _it depends_. 
Statistically significant difference is when, at a given level of confidence, we reject the null hypothesis that two statistics are derived from the same population, and that there is a genuine difference in performance between the two groups. 
Commercially, this means that we believe there is an acceptably low likelihood that our survey has poorly sampled the true population, and that therefore the difference we see between our two brands is reflective of a real difference that exists in Net Promoter Score.

Whilst this can be achieved by a simple T test for two brands (**NB:this should nearly always be a Welch test - see this great article by XXX on why**), this becomes more tricky when there are multiple brands to consider. The way to achieve this is a post-hoc test of honest significant difference. For a straight Student T test we can use Tukey's Significant Difference Test, for running a post-hoc test on a Welch T test we need to look at the Games-Howell post-hoc test.

OK - problem solved then? Sadly, NPS is a compound statistic, with very wide confidence intervals, as we will see below. We will cover a way to artificially get round this (by bootstrapping our sample), but fundamentally NPS is always going to provide problems for data scientists. A much better option is to advise stakeholders to run 'overall rating' scores.


### So why does NPS pose problems for statistical analysis?

NPS is calculated by asking customers to rate the brand from 0 to 10, on how likely they would be to recommend the brand to a friend or colleague. Respondents who score 9 or 10 are considered _Promoters_, those who score 7 or 8 are _Passives_, and those who score 6 or less are considered _Detractors_. The % of all respondents who are Promoters less the % who are Detractors is our Net Promoter Score:

$$ 
Net\ Promoter\ Score = \% Promoters - \% Detractors
$$
This can be also calculated as follows:

$$
Net\ Promoter\ Score = \frac{Number\ of\ Promoters}{Total\ Number\ of\ Respondents} - \frac{Number\ of\ Detractors}{Total\ Number\ of\ Respondents} 
$$
Promoters are all considered equal (a 9 is valued the same as a 10), as are Detractors (responding with a 6 is considered to be as _dissatisfied_ as someone scoring 0). Ignoring the inherent issues in that for a second, this means that we could replace respondents' numeric scores (between 0 and 10) with a categorical variable, or a pair of dummies: a 0 or 1 flag for _Promoter_ and _Detractor_ (where 0 in both is our reference category - _Passives_).

Our NPS stat can now be calculated as follows:

$$
Net\ Promoter\ Score = \frac{Number\ of\ Promoter\ flags}{Total\ Number\ of\ Respondents} - \frac{Number\ of\ Detractors\ flags}{Total\ Number\ of\ Respondents} 
$$

This is effectively the difference between the mean of the Promoter flag, and the mean of the Detractor flag. Since the difference between means is the same as mean difference, this can be rewritten as follows, meaning we can map Promoter scores to 1, Passives to 0, and Detractors to -1. The mean of this transformed NPS score will also return the Net Promoter Score, which will as ever be a value between +1 and -1.

$$
Net\ Promoter\ Score = \frac{Number\ of\ Promoter\ flags\ -\ Number\ of\ Detractor\ flags}{Total\ Number\ of\ Respondents} = Mean(Net\ Promoter\ Score\ Flag)
$$

### Implications for Statistical Analysis

By being able to transform the raw scores into something that can be computed as a mean, then we can also compute standard deviation, and therefore confidence intervals and run hypothesis tests. It is here that our true troubles begin. 

Our transformed metric will have a mean that sits between -1 and +1, but our variance will be relatively large - every promoter or detractor returns a max or min value! See the example below with a sample of 100 respondents, where there are 30 Promoters and 20 Detractors:

```{r echo= FALSE}
n <- 100
n_promoters_brand_a <- 30
n_detractors_brand_a <- 20
n_passives_brand_a <- n - n_promoters_brand_a - n_detractors_brand_a

promoter_sample_brand_a <- rep(1, times = n_promoters_brand_a)
passive_sample_brand_a <- rep(0, times = n_passives_brand_a)
detractor_sample_brand_a <- rep(-1, times = n_detractors_brand_a)
brand_a <- c(promoter_sample_brand_a, passive_sample_brand_a, detractor_sample_brand_a)
```

#### Net Promoter Score (as %)

```{r echo = FALSE, comment = ''}
paste0(round(mean(brand_a),2)*100,"%")
```

#### NPS Variance (as %)

```{r echo = FALSE, comment = ''}
paste0(round(var(brand_a),2)*100,"%")
```

Wow - we have an NPS of 10%, but the variance is 49%! This has a major impact on confidence intervals:

```{r echo = FALSE, comment = ''}
library(ggplot2)
library(scales)
ci_mean <- data.frame(vals = c(mean(brand_a) - 1.96*(sd(brand_a)/sqrt(length(brand_a))), mean(brand_a), mean(brand_a) + 1.96*(sd(brand_a)/sqrt(length(brand_a)))), labels = c('Brand A Lower CI (95%)', 'Brand A NPS Statistic', 'Brand A Upper CI (95%)'))

d <- ggplot() + aes(brand_a) + 
  geom_density() + geom_vline(data = ci_mean, aes(xintercept= vals), color="blue", size=0.5) + geom_text(data = ci_mean, aes(x=vals, y = 0.5, label = labels), size = 4, angle = 90, vjust = -0.4, ) + ggtitle(label = "Transformed NPS with NPS statistic and Confidence Intervals (95%)") + scale_x_continuous(labels = percent)
d
```

Our survey sample NPS statistic is 10%, but 95% confidence intervals suggest that the _true population NPS statistic_ (the metric if you were to ask the **entire addressable market**) is anywhere between ~-6% and ~28%!

This makes it nigh on impossible to determine a significant difference between our brand and our competitor, who have an NPS of -5% from our survey (again n = 100, this time there are 36 Promoters and 32 Detractors).

```{r echo= FALSE}
n <- 100
n_promoters_brand_b <- 20
n_detractors_brand_b <- 25
n_passives_brand_b <- n - n_promoters_brand_b - n_detractors_brand_b


promoter_sample_brand_b <- rep(1, times = n_promoters_brand_b)
passive_sample_brand_b <- rep(0, times = n_passives_brand_b)
detractor_sample_brand_b <- rep(-1, times = n_detractors_brand_b)
brand_b <- c(promoter_sample_brand_b, passive_sample_brand_b, detractor_sample_brand_b)
npss_brand_b <- mean(brand_b)

df <- as.data.table(cbind(brand_a, brand_b))
melted <- melt(df)

ci_mean_a <- data.frame(vals = c(mean(brand_a) - 1.96*(sd(brand_a)/sqrt(length(brand_a))), mean(brand_a), mean(brand_a) + 1.96*(sd(brand_a)/sqrt(length(brand_a)))), labels = c('Brand A Lower CI (95%)', 'Brand A NPS Statistic', 'Brand A Upper CI (95%)'))

ci_mean_b <- data.frame(vals = c(mean(brand_b) - 1.96*(sd(brand_a)/sqrt(length(brand_b))), mean(brand_b), mean(brand_b) + 1.96*(sd(brand_b)/sqrt(length(brand_b)))), labels = c('Brand B Lower CI (95%)', 'Brand B NPS Statistic', 'Brand B Upper CI (95%)'))

d <- ggplot(data = melted) + aes(x = value, fill = variable, alpha = 0.5) + 
  geom_density() + geom_vline(data = ci_mean_a, aes(xintercept= vals), color="blue", size=0.5) + geom_text(data = ci_mean_a, aes(xintercept= vals, label = labels))
##+ geom_text(data = ci_mean_a, aes(x=vals, y = 0.5, label = labels), size = 4, angle = 90, vjust = -0.4) + geom_vline(data = ci_mean_b, aes(xintercept= vals), color="red", size=0.5) + geom_text(data = ci_mean_b, aes(x=vals, y = 0.5, label = labels), size = 4, angle = 90, vjust = -0.4, )  + ggtitle(label = "NPS statistic and Confidence Intervals (95%) for Brands A and B") + scale_x_continuous(labels = percent)
d
```

